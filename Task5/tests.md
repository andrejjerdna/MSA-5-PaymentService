# Набор тестов для PaymentSagaProcess

| Название | Тип | Компоненты | Предусловия |
|----------|-----|------------|-------------|
| **Успешная транзакция** | E2E | Zeebe, BPMN процесс, Payment Service, FraudCheck Service, Notification Service, БД | • Zeebe engine запущен<br>• Процесс задеплоен<br>• Мок антифрода настроен на APPROVED<br>• БД доступна |
| **Отклонено антифродом** | E2E |  Zeebe, BPMN процесс, Payment Service, FraudCheck Service, Notification Service, БД | • Zeebe engine запущен<br>• Процесс задеплоен<br>• Мок антифрода настроен на REJECTED<br>• Система возврата доступна |
| **Ручная проверка. Одобрение** | E2E |  Zeebe, BPMN процесс, Payment Service, FraudCheck Service, Notification Service, БД | • Zeebe engine запущен<br>• Процесс задеплоен<br>• Мок антифрода настроен на MANUAL_REVIEW<br>• Оператор доступен для проверки |
| **Ручная проверка. Отклонение** | E2E |  Zeebe, BPMN процесс, Payment Service, FraudCheck Service, Notification Service, БД | • Zeebe engine запущен<br>• Процесс задеплоен<br>• Мок антифрода настроен на MANUAL_REVIEW<br>• Оператор отклоняет транзакцию |
| **Ручная проверка. Исчерпано время ожидания** | E2E | Zeebe, BPMN процесс, wait-manual-review, таймауты | • Zeebe engine запущен<br>• Процесс задеплоен<br>• Таймаут задачи установлен в 20 мин<br>• Ответ от оператора не поступает |
| **Создание платежа. Валидные данные** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован в Zeebe<br>• БД платежных поручений доступна<br>• Переданы валидные: userId, amount, merchantId |
| **Создание платежа. Невалидные данные** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован<br>• Отсутствуют обязательные поля в Variables |
| **Проверка счета. Средств достаточно** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован<br>• reservedFundsId существует и валиден<br>• На счете достаточно средств |
| **Проверка счета. Средств не достаточно** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован<br>• reservedFundsId существует<br>• Недостаточно средств для списания |
| **Проверка операции. Операция одобрена** | Интеграционный | Zeebe, BPMN процесс, FraudCheck Service | • Обработчик зарегистрирован<br>• Антифрод система доступна<br>• Данные транзакции не подозрительные |
| **Проверка операции. Операция отклонена** | Интеграционный | Zeebe, BPMN процесс, FraudCheck Service | • Обработчик зарегистрирован<br>• Антифрод система доступна<br>• Данные транзакции подозрительные |
| **Проверка операции. Отправлено на ручную проверку** | Интеграционный | Zeebe, BPMN процесс, FraudCheck Service | • Обработчик зарегистрирован<br>• Антифрод система доступна<br>• Данные транзакции пограничные |
| **Ожидание ручной проверки. Одобрено** | Интеграционный | Zeebe, BPMN процесс, FraudCheck Service | • Обработчик зарегистрирован<br>• Оператор одобряет транзакцию<br>• Время ответа < 20 мин |
| **Ожидание ручной проверки. Отклонено** | Интеграционный | Zeebe, BPMN процесс, FraudCheck Service | • Обработчик зарегистрирован<br>• Оператор отклоняет транзакцию<br>• Указана причина отказа |
| **Возврат оплаты. Успешная операция** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован<br>• reservedFundsId существует<br>• Система возвратов доступна |
| **Возврат оплаты. Неуспешная операция** | Интеграционный | Zeebe, BPMN процесс, Payment Service | • Обработчик зарегистрирован<br>• Первый возврат уже выполнен<br>• Проверка идемпотентности |
| **Отправка уведомлени. Успешная операция** | Интеграционный | Zeebe, BPMN процесс, Notification Service | • Обработчик зарегистрирован<br>• Система уведомлений доступна<br>• Контекст успешной транзакции |
| **Отправка уведомлени. Неуспешная операция** | Интеграционный | Zeebe, BPMN процесс, Notification Service | • Обработчик зарегистрирован<br>• Система уведомлений доступна<br>• Контекст отклоненной транзакции |
| **Деплой Zeebe** | Интеграционный | Zeebe client, BPMN модель | • Zeebe engine доступен<br>• BPMN файл корректен<br>• Права на деплой есть |
